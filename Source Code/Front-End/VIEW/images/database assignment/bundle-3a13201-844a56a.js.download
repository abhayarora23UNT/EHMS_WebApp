(function(window,undefined){"$:nomunge";var $=window.jQuery||window.Cowboy||(window.Cowboy={}),jq_throttle;$.throttle=jq_throttle=function(delay,no_trailing,callback,debounce_mode){var timeout_id,last_exec=0;if(typeof no_trailing!=="boolean"){debounce_mode=callback;callback=no_trailing;no_trailing=undefined}function wrapper(){var that=this,elapsed=+new Date-last_exec,args=arguments;function exec(){last_exec=+new Date;callback.apply(that,args)}function clear(){timeout_id=undefined}if(debounce_mode&&!timeout_id){exec()}timeout_id&&clearTimeout(timeout_id);if(debounce_mode===undefined&&elapsed>delay){exec()}else if(no_trailing!==true){timeout_id=setTimeout(debounce_mode?clear:exec,debounce_mode===undefined?delay-elapsed:delay)}}if($.guid){wrapper.guid=callback.guid=callback.guid||$.guid++}return wrapper};$.debounce=function(delay,at_begin,callback){return callback===undefined?jq_throttle(delay,at_begin,false):jq_throttle(delay,callback,at_begin!==false)}})(this);$(document).ready(function(){$(".roadblock-button").on("click",function(e){ga("send","event","Doc Landing Page","Conversion Action","Roadblock button")});$("#conversion-link-below-preview").on("click",function(e){ga("send","event","Doc Landing Page","Conversion Action","Link after preview")});$("#link-after-text-preview").on("click",function(e){ga("send","event","Doc Landing Page","Conversion Action","Link after text preview")});$(".ch_h-search-form-submit_button").on("click",function(e){ga("send","event","Doc Landing Page","Search","Header Search Bar")});$(".ch_h-search-form_input").on("keydown",function(e){if(e.keyCode==13){ga("send","event","Doc Landing Page","Search","Header Search Bar")}});$("#breadcrumbs-home").on("click",function(e){ga("send","event","Doc Landing Page","Breadcrumbs","Breadcrumb - Home")});$("#breadcrumbs-school").on("click",function(e){ga("send","event","Doc Landing Page","Breadcrumbs","Breadcrumb - School")});$("#breadcrumbs-dept").on("click",function(e){ga("send","event","Doc Landing Page","Breadcrumbs","Breadcrumb - Dept")});$("#breadcrumbs-course").on("click",function(e){ga("send","event","Doc Landing Page","Breadcrumbs","Breadcrumb - Course")});$("#sidebar-course-crosslink").on("click",function(e){ga("send","event","Doc Landing Page","Crosslinks","Crosslink - Course")});$.each(jQuery(".html-preview"),function(i,e){var url=$(this).data("bg-src");$(this).find("img.html-preview-bg-img").attr("src",url)});var _mcq_question_state={collapsedOrExpanded:false,onePage:false,multiPage:false,collapsed:false,expanded:false,afterText:false,copy:false};var MAX_MCQ_QUESTION_CTA_HEIGHT=372;var MIN_MCQ_QUESTION_CTA_HEIGHT=90;var create_translate=function(dx,dy){return{"-webkit-transform":"translate("+dx+"px,"+dy+"px)","-moz-transform":"translate("+dx+"px,"+dy+"px)","-ms-transform":"translate("+dx+"px,"+dy+"px)","-o-transform":"translate("+dx+"px,"+dy+"px)",transform:"translate("+dx+"px,"+dy+"px)"}};var calculate_papercut_range=function(element,papercut){if(element["pageNum"]<papercut["topPageNum"]||element["pageNum"]===papercut["topPageNum"]&&element["top"]<papercut["top"]){papercut["top"]=element["top"]}papercut["topPageNum"]=Math.min(element["pageNum"],papercut["topPageNum"]);if(element["pageNum"]>papercut["bottomPageNum"]||element["pageNum"]===papercut["bottomPageNum"]&&element["bottom"]>papercut["bottom"]){papercut["bottom"]=element["bottom"]}papercut["bottomPageNum"]=Math.max(element["pageNum"],papercut["bottomPageNum"])};var calculate_page_bound_range=function(element,pageBound){if(pageBound[element["pageNum"]].top===0||pageBound[element["pageNum"]].top>element["top"]){pageBound[element["pageNum"]].top=element["top"]}if(pageBound[element["pageNum"]].bottom===0||pageBound[element["pageNum"]].bottom<element["bottom"]){pageBound[element["pageNum"]].bottom=element["bottom"]}};var handle_expand_collapse_element_resize=function(mcqAfterTextStartPage,mcqAfterTextStartTop,answerStartPage,mcqTop,overlapQA,questionBottom,scale){if(_mcq_question_state["collapsedOrExpanded"]){var answerParentMaxHeight;var afterTextBottom;var translateDistance;var answerParent=$("#html-prev-"+answerStartPage).parent();if(_mcq_question_state["onePage"]){if(_mcq_question_state["copy"]){var htmlPrevCopy=$("#html-prev-"+answerStartPage+"-copy");afterTextBottom=htmlPrevCopy.find(".mcq_after_text").data("bottom");var cloneParentMaxHeight=scale*afterTextBottom-mcqAfterTextStartTop;htmlPrevCopy.parent().css("max-height",cloneParentMaxHeight);translateDistance=-1*mcqAfterTextStartTop;htmlPrevCopy.css(create_translate(0,translateDistance))}if(_mcq_question_state["collapsed"]){answerParentMaxHeight=mcqTop+MAX_MCQ_QUESTION_CTA_HEIGHT}else if(_mcq_question_state["expanded"]===false){answerParentMaxHeight=MIN_MCQ_QUESTION_CTA_HEIGHT}else{translateDistance=-1*mcqTop;$("#html-prev-"+answerStartPage+"-bg").css(create_translate(0,translateDistance));answerParentMaxHeight=overlapQA?scale*questionBottom:mcqTop}}else if(_mcq_question_state["multiPage"]){if(_mcq_question_state["collapsed"]&&_mcq_question_state["afterText"]){var afterTextDiv=$("#html-prev-"+mcqAfterTextStartPage);afterTextBottom=afterTextDiv.find(".mcq_after_text").data("bottom");var afterTextMaxHeight=scale*afterTextBottom-mcqAfterTextStartTop;afterTextDiv.parent().css("max-height",afterTextMaxHeight);translateDistance=-1*mcqAfterTextStartTop;afterTextDiv.css(create_translate(0,translateDistance))}else if(_mcq_question_state["expanded"]){translateDistance=-1*mcqTop;$("#html-prev-"+answerStartPage+"-bg").css(create_translate(0,translateDistance));answerParentMaxHeight=mcqTop}}answerParent.css("max-height",answerParentMaxHeight)}};var resize_document_viewer=function(){if(useSSIDocViewer){return}var doc_page_container=jQuery("#bdp_image-preview_container"),doc_page_container_split=parseInt(doc_page_container.data("split")),doc_page_container_scrollTo=parseFloat(doc_page_container.data("scrollto")),doc_preview_multiple=parseFloat(doc_page_container.data("doc-preview-multiple"));if(doc_page_container_split!=0){var scrollToPixel=doc_page_container.outerHeight()/doc_preview_multiple*(doc_page_container_scrollTo/100)-50;doc_page_container.scrollTop(scrollToPixel)}var scale=doc_page_container.width()/640;var cssTransform={transform:"scale("+scale+")","transform-origin":"top left","-webkit-transform":"scale("+scale+")","-webkit-transform-origin":"top left","-moz-transform":"scale("+scale+")","-moz-transform-origin":"top left","-ms-transform":"scale("+scale+")","-ms-transform-origin":"top left","-o-transform":"scale("+scale+")","-o-transform-origin":"top left"};var scaleSelector=".html-preview-text, .html-preview-no-text";var wrappers=$(".dq-wrapper");if(wrappers.length>0){scaleSelector=".dq-wrapper"}var html_preview_text=$(scaleSelector);html_preview_text.css(cssTransform);html_preview_text.each(function(i,el){var html_preview_wrapper=$(el).parent();if($(el).height()>0){if(isLoggedIn){html_preview_wrapper.height($(el).height()*scale)}else{html_preview_wrapper.height($(el).height())}}});$("#pg1").css("min-height","initial");if(canDisplayMcq&&mobileUxBucket<1&&answerBlockerBucket<2&&!useSSIDocViewer){$(document).ready(function(){if($(".mcq_blocker_container")[0]){for(var i=startPage;i<=endPage;i++){var sel='div.mcq_blocker_container[data-page="'+i+'"]';var MCQBlock=null;var divhtmlPrev="#html-prev-"+i;if($(divhtmlPrev).length!=0){var maxMCQBlock=$(sel).length;var mcqTop=0;var mcqBottom=0;var mcqHeight=0;var mcqMulCol=[];var MCQblock1=null;var MCQblock2=null;for(var k=0;k<$(sel).length;k++){for(var j=0;j<$(sel).length;j++){if(j!=k){MCQblock1=$($(sel)[k]);MCQblock2=$($(sel)[j]);if(MCQblock1.parent()!=MCQblock2.parent()){continue}y1MCQblock1=parseFloat(MCQblock1.attr("data-top"));y2MCQblock1=parseFloat(MCQblock1.attr("data-bottom"));y1MCQblock2=parseFloat(MCQblock2.attr("data-top"));y2MCQblock2=parseFloat(MCQblock2.attr("data-bottom"));if(y1MCQblock1<y1MCQblock2&&y2MCQblock1>y2MCQblock2||y1MCQblock1>y1MCQblock2&&y1MCQblock1<y2MCQblock2||y2MCQblock1>y1MCQblock2&&y2MCQblock1<y2MCQblock2){if(mcqMulCol.indexOf(j)==-1){mcqMulCol.push(j)}if(mcqMulCol.indexOf(k)==-1){mcqMulCol.push(k)}}}}}for(var j=0;j<$(sel).length;j++){MCQBlock=$($(sel)[j]);if(maxMCQBlock==0){break}maxMCQBlock--;if(mcqMulCol.indexOf(j)>-1){continue}mcqTop=parseFloat(MCQBlock.attr("data-top"));mcqBottom=parseFloat(MCQBlock.attr("data-bottom"));mcqHeight=Math.abs(mcqBottom-mcqTop);if(!isQIV2&&(MCQBlock.hasClass("frq")||typeof _lockedDocumentMetadataProperties!=="undefined"&&_lockedDocumentMetadataProperties["identifiedQuestionTypes"].indexOf("FRQ")>=0)){mcqHeight-=25.5}mcqHeight=Math.max(32,mcqHeight);if(!frqBlocker){mcqHeight=Math.min(mcqHeight,MAX_MCQ_QUESTION_CTA_HEIGHT)}mcqTop=mcqTop*scale;mcqHeight=mcqHeight*scale;MCQBlock.css({display:"flex",top:mcqTop,height:mcqHeight});MCQBlock.parent().css({position:"relative"});if(frqBlocker&&showOutOfViewsBlocker===1){MCQBlock.hide()}}}}}})}if(canDisplayQuestionMcq){$(document).ready(function(){var papercut={};papercut["top"]=9999;papercut["bottom"]=0;papercut["topPageNum"]=endPage;papercut["bottomPageNum"]=startPage;var answerStartPage=0;var answerEndPage=0;var mcqAfterTextStartPage=0;var mcqAfterTextStartTop=0;var answerPages=[];var pageBound=[];for(var i=startPage;i<=endPage;i++){pageBound[i]={top:0,bottom:0}}var scaleSelector=".html-preview-text, .html-preview-no-text";var wrappers=$(".dq-wrapper");if(wrappers.length>0){scaleSelector=".dq-wrapper"}var html_preview_text=$(scaleSelector);html_preview_text.css(cssTransform);html_preview_text.each(function(i,el){var html_preview_wrapper=$(el).parent();if($(el).height()>0){var oldHeight;if(isLoggedIn){oldHeight=$(el).height()*scale}else{oldHeight=$(el).height()}if(answerBlockerBucket===2){var newHeight=0;var injectWrappers=html_preview_wrapper.find(".ch-inject-wrapper");injectWrappers.each(function($idx,$injectWrapper){newHeight+=Math.max(parseFloat($($injectWrapper).attr("data-height")),180)});var heightToUse=Math.max(oldHeight,newHeight);html_preview_wrapper.height(heightToUse)}else{html_preview_wrapper.height(oldHeight)}}});var mcqHeight=0;var mcqTop=0;var MCQBlock=null;var answerParentMaxHeight=0;var overlapQA=false;var questionBottom=0;if($(".mcq_before_text").length!=0||$(".mcq_blocker_container").length!=0||$(".mcq_after_text").length!=0){$(".mcq_before_text").each(function(){var mcqBefore={};mcqBefore["top"]=parseFloat($(this).data("top"));mcqBefore["bottom"]=parseFloat($(this).data("bottom"));mcqBefore["pageNum"]=parseInt($(this).data("page"));var htmlPreviewDiv=$(this).parent().parent();if(mcqBefore["top"]!=-1&&mcqBefore["bottom"]!=-1&&isNaN(mcqBefore["top"])==false){calculate_papercut_range(mcqBefore,papercut);if(!htmlPreviewDiv.hasClass("mcqbg")&&!htmlPreviewDiv.hasClass("mcqcopy")){calculate_page_bound_range(mcqBefore,pageBound)}questionBottom=papercut["bottom"]}});$(".mcq_blocker_container").each(function(){var mcqAnswer={};mcqAnswer["top"]=parseFloat($(this).data("top"));mcqAnswer["bottom"]=parseFloat($(this).data("bottom"));mcqAnswer["pageNum"]=parseInt($(this).data("page"));var htmlPreviewDiv=$(this).parent().parent();var hasMCQAnswerQuestionId=typeof $(this).data("questionid")!=="undefined";if(mcqAnswer["top"]!=-1&&mcqAnswer["bottom"]!=-1&&isNaN(mcqAnswer["top"])==false&&hasMCQAnswerQuestionId){if(mcqAnswer["pageNum"]==papercut["topPageNum"]&&mcqAnswer["pageNum"]==papercut["bottomPageNum"]&&mcqAnswer["top"]>=papercut["top"]&&mcqAnswer["top"]<=papercut["bottom"]){overlapQA=true}calculate_papercut_range(mcqAnswer,papercut);if(mcqTop==0){mcqTop=mcqAnswer["top"];mcqHeight=mcqAnswer["bottom"]-mcqAnswer["top"];answerStartPage=mcqAnswer["pageNum"];answerEndPage=mcqAnswer["pageNum"];MCQBlock=$(this)}else{mcqHeight+=mcqAnswer["bottom"]-mcqAnswer["top"];answerEndPage=mcqAnswer["pageNum"]}if(answerPages.indexOf(mcqAnswer["pageNum"])==-1){answerPages.push(mcqAnswer["pageNum"])}if(!htmlPreviewDiv.hasClass("mcqbg")&&!htmlPreviewDiv.hasClass("mcqcopy")){calculate_page_bound_range(mcqAnswer,pageBound)}}});if(MCQBlock){mcqTop=mcqTop*scale;mcqHeight=mcqHeight*scale;MCQBlock.css("display","flex");MCQBlock.parent().css({position:"relative"});MCQBlock.css("top",mcqTop);MCQBlock.css("height",mcqHeight);if(mcqHeight>MAX_MCQ_QUESTION_CTA_HEIGHT||_mcq_question_state["collapsed"]){MCQBlock.css("height",MAX_MCQ_QUESTION_CTA_HEIGHT);answerParentMaxHeight=mcqTop+MAX_MCQ_QUESTION_CTA_HEIGHT}else if(mcqHeight<MIN_MCQ_QUESTION_CTA_HEIGHT||_mcq_question_state["expanded"]){MCQBlock.css("height",MIN_MCQ_QUESTION_CTA_HEIGHT);answerParentMaxHeight=overlapQA?scale*questionBottom:mcqTop}}$(".mcq_after_text").each(function(){var mcqAfter={};mcqAfter["top"]=parseFloat($(this).data("top"));mcqAfter["bottom"]=parseFloat($(this).data("bottom"));mcqAfter["pageNum"]=parseInt($(this).data("page"));var htmlPreviewDiv=$(this).parent().parent();if(mcqAfter["top"]!=-1&&mcqAfter["bottom"]!=-1&&isNaN(mcqAfter["top"])==false){calculate_papercut_range(mcqAfter,papercut);if(mcqAfterTextStartPage==0){mcqAfterTextStartPage=mcqAfter["pageNum"];mcqAfterTextStartTop=mcqAfter["top"]}if(!htmlPreviewDiv.hasClass("mcqbg")&&!htmlPreviewDiv.hasClass("mcqcopy")){calculate_page_bound_range(mcqAfter,pageBound)}}});mcqAfterTextStartTop=scale*mcqAfterTextStartTop;var marginTop=0;if(papercut["top"]<9999){marginTop=-1*(scale*papercut["top"])}var maxHeight=0;$(".bdp_preview_single_question.html-preview").not(".mcqcopy, .mcqbg").each(function(){var currentPage=$(this).find(".mcq_before_text").data("page");if(answerParentMaxHeight!=0&&(mcqTop<MIN_MCQ_QUESTION_CTA_HEIGHT||mcqHeight>MAX_MCQ_QUESTION_CTA_HEIGHT)){maxHeight=answerParentMaxHeight}else{maxHeight=scale*papercut["bottom"]}if(typeof currentPage==="undefined"||currentPage<papercut["topPageNum"]||currentPage>papercut["bottomPageNum"]){$(this).css("display","none")}else if(currentPage==papercut["topPageNum"]&&currentPage==papercut["bottomPageNum"]){marginTop=marginTop+18;$(this).css("margin-top",marginTop);$(this).css("max-height",maxHeight);$(this).css("overflow","hidden")}else if(currentPage==papercut["topPageNum"]){maxHeight=scale*parseFloat(pageBound[currentPage].bottom);marginTop=marginTop+18;$(this).css("margin-top",marginTop);$(this).css("overflow","hidden");$(this).css("max-height",maxHeight)}else{maxHeight-=scale*parseFloat(pageBound[currentPage].top);var translatePage=-1*scale*parseFloat(pageBound[currentPage].top);$(this).css("max-height",maxHeight);$(this).css("overflow","hidden");$(this).find("#html-prev-"+currentPage).css(create_translate(0,translatePage))}});$("#bdp_image-preview_container").css("margin-top","12px");$(".ch_docBookmark_wrapper_action").parent().addClass("mcq_bookmark");if(mcqHeight<MIN_MCQ_QUESTION_CTA_HEIGHT||mcqHeight>MAX_MCQ_QUESTION_CTA_HEIGHT){_mcq_question_state["collapsedOrExpanded"]=true;if(answerEndPage!=0&&answerStartPage!=0){var answerParent=$("#html-prev-"+answerStartPage).parent();if(answerEndPage==answerStartPage){_mcq_question_state["onePage"]=true;if(mcqAfterTextStartPage==answerEndPage&&$("#html-prev-"+answerStartPage+"-copy").length==0){_mcq_question_state["copy"]=true;var mcqAfterBottom=parseFloat($("#html-prev-"+mcqAfterTextStartPage).find(".mcq_after_text").data("bottom"));var cloneParent=answerParent.clone();cloneParent.find("#html-prev-"+answerStartPage).attr("id","html-prev-"+answerStartPage+"-copy");cloneParent.find("#fonts"+answerStartPage).attr("id","fonts"+answerStartPage+"-copy");cloneParent.find("#pg"+answerStartPage).attr("id","pg"+answerStartPage+"-copy");$("#html-prev-"+answerStartPage).find(".mcq_after_text").remove();$("#html-prev-"+answerStartPage).find(".mcq_after").remove();cloneParent.insertAfter(answerParent);$("#html-prev-"+answerStartPage+"-copy").find(".mcq_before_text").remove();$("#html-prev-"+answerStartPage+"-copy").find(".mcq_before").remove();$("#html-prev-"+answerStartPage+"-copy").find(".mcq_blocker_container").remove();var cloneParentMaxHeight=scale*mcqAfterBottom-mcqAfterTextStartTop;$("#html-prev-"+answerStartPage+"-copy").parent().css("max-height",cloneParentMaxHeight);$("#html-prev-"+answerStartPage+"-copy").parent().css("margin-top",0);$("#html-prev-"+answerStartPage+"-copy").parent().css("overflow","hidden");$("#html-prev-"+answerStartPage+"-copy").parent().addClass("mcqcopy");var translateMcqAfter=-1*mcqAfterTextStartTop;$("#html-prev-"+answerStartPage+"-copy").css(create_translate(0,translateMcqAfter))}if(mcqHeight>MAX_MCQ_QUESTION_CTA_HEIGHT){_mcq_question_state["collapsed"]=true;answerParentMaxHeight=mcqTop+MAX_MCQ_QUESTION_CTA_HEIGHT}else if(mcqHeight<MIN_MCQ_QUESTION_CTA_HEIGHT&&$("#html-prev-"+answerStartPage+"-bg").length==0){if($("#html-prev-"+answerStartPage).find(".mcq_blocker_container").data("top")==pageBound[answerStartPage].top&&overlapQA==false){answerParentMaxHeight=MIN_MCQ_QUESTION_CTA_HEIGHT}else{_mcq_question_state["expanded"]=true;var cloneBg=answerParent.clone();cloneBg.find("#html-prev-"+answerStartPage).attr("id","html-prev-"+answerStartPage+"-bg");cloneBg.find("#fonts"+answerStartPage).attr("id","fonts"+answerStartPage+"-bg");cloneBg.find("#pg"+answerStartPage).attr("id","pg"+answerStartPage+"-bg");$("#html-prev-"+answerStartPage).find(".mcq_blocker_container").remove();cloneBg.insertAfter(answerParent);$("#html-prev-"+answerStartPage+"-bg").find(".mcq_before_text").remove();$("#html-prev-"+answerStartPage+"-bg").find(".mcq_before").remove();$("#html-prev-"+answerStartPage+"-bg").find(".mcq_after_text").remove();$("#html-prev-"+answerStartPage+"-bg").find(".mcq_after").remove();$("#html-prev-"+answerStartPage+"-bg").parent().css("max-height",MIN_MCQ_QUESTION_CTA_HEIGHT+"px");$("#html-prev-"+answerStartPage+"-bg").parent().css("margin-top","0px");$("#html-prev-"+answerStartPage+"-bg").parent().css("overflow","hidden");$("#html-prev-"+answerStartPage+"-bg").parent().addClass("mcqbg");var translateMcq=-1*mcqTop;cloneBg.find("#html-prev-"+answerStartPage+"-bg").css(create_translate(0,translateMcq));answerParentMaxHeight=overlapQA?scale*questionBottom:mcqTop}}}else{_mcq_question_state["multiPage"]=true;var answerStartPageBottom=parseFloat($("#html-prev-"+answerPages[0]).find(".mcq_blocker_container").data("bottom"));var answerStartPageTop=parseFloat($("#html-prev-"+answerPages[0]).find(".mcq_blocker_container").data("top"));var answerHeightPage1=answerStartPageBottom-answerStartPageTop;if(answerHeightPage1>=MAX_MCQ_QUESTION_CTA_HEIGHT){_mcq_question_state["collapsed"]=true;var i=answerStartPage+1;if(mcqAfterTextStartPage!=0){_mcq_question_state["afterText"]=true;while(i<mcqAfterTextStartPage){$("#html-prev-"+i).parent().css("display","none");i++}var mcqAfterBottom=parseFloat($("#html-prev-"+mcqAfterTextStartPage).find(".mcq_after_text").data("bottom"));$("#html-prev-"+mcqAfterTextStartPage).find(".mcq_before_text").remove();$("#html-prev-"+mcqAfterTextStartPage).find(".mcq_before").remove();$("#html-prev-"+mcqAfterTextStartPage).find(".mcq_blocker_container").remove();var mcqAfterMaxHeight=scale*mcqAfterBottom-mcqAfterTextStartTop;$("#html-prev-"+mcqAfterTextStartPage).parent().css("max-height",mcqAfterMaxHeight);var translatemcqAfter=-1*mcqAfterTextStartTop;$("#html-prev-"+mcqAfterTextStartPage).css(create_translate(0,translatemcqAfter))}else{while(i<=answerEndPage){$("#html-prev-"+i).parent().css("display","none");i++}}}else{if(answerHeightPage1<MIN_MCQ_QUESTION_CTA_HEIGHT){_mcq_question_state["expanded"]=true;var cloneBg=answerParent.clone();cloneBg.find("#html-prev-"+answerStartPage).attr("id","html-prev-"+answerStartPage+"-bg");cloneBg.find("#fonts"+answerStartPage).attr("id","fonts"+answerStartPage+"-bg");cloneBg.find("#pg"+answerStartPage).attr("id","pg"+answerStartPage+"-bg");$("#html-prev-"+answerStartPage).find(".mcq_blocker_container").remove();cloneBg.insertAfter(answerParent);$("#html-prev-"+answerStartPage+"-bg").find(".mcq_before_text").remove();$("#html-prev-"+answerStartPage+"-bg").find(".mcq_before").remove();$("#html-prev-"+answerStartPage+"-bg").find(".mcq_after_text").remove();$("#html-prev-"+answerStartPage+"-bg").find(".mcq_after").remove();$("#html-prev-"+answerStartPage+"-bg").parent().css("max-height",MIN_MCQ_QUESTION_CTA_HEIGHT+"px");$("#html-prev-"+answerStartPage+"-bg").parent().css("margin-top","0px");$("#html-prev-"+answerStartPage+"-bg").parent().css("overflow","hidden");$("#html-prev-"+answerStartPage+"-bg").parent().addClass("mcqbg");var translateMcqTop=-1*mcqTop;$("#html-prev-"+answerStartPage+"-bg").css(create_translate(0,translateMcqTop));answerParentMaxHeight=mcqTop}}}answerParent.css("max-height",answerParentMaxHeight);answerParent.css("overflow","hidden")}}handle_expand_collapse_element_resize(mcqAfterTextStartPage,mcqAfterTextStartTop,answerStartPage,mcqTop,overlapQA,questionBottom,scale)}})}var flexibleSamplingElem=$(".flexible-sampling-doc-bottom-container").siblings("[id^=html-prev]");var flexible_sampling_page_height=parseInt(flexibleSamplingElem.attr("default-height"));if(!isNaN(flexible_sampling_page_height)){flexibleSamplingElem.height(flexible_sampling_page_height*scale);flexibleSamplingElem.css("overflow","hidden")}if($(window).width()<991){$("#ch-footer").css("margin-bottom",$(".mobile-sticky-footer").outerHeight())}else{$("#ch-footer").css("margin-bottom",0)}};if(!useSSIDocViewer){$(window).on("resize",resize_document_viewer)}resize_document_viewer();var mcqDataLoadedPages=[];var loadMCQData=function(){var PREVIOUS_PAGE_RANGE=1;var AFTER_PAGE_RANGE=3;var currentPage=window.pageNum;if(!currentPage||!window.endPage){return}var startPage=currentPage-PREVIOUS_PAGE_RANGE;var endPage=Math.min(currentPage+AFTER_PAGE_RANGE,window.endPage);var pagesToLoad=[];for(var page=startPage;page<=endPage;page++){if(mcqDataLoadedPages.indexOf(page)===-1){mcqDataLoadedPages.push(page);pagesToLoad.push(page)}}if(pagesToLoad.length===0){return}startPage=pagesToLoad[0];endPage=pagesToLoad[pagesToLoad.length-1];fetch("/api/v1/mcq/documents/"+dbFilename+"/questions/",{data:JSON.stringify({startPage:startPage,endPage:endPage})}).then(function(response){return response.json()}).then(associateMCQDataWithMCQBlockerContainers)};var associateMCQDataWithMCQBlockerContainers=function(response){if(!response||!response.rows){return}var questions=response.rows.questions;var answers=response.rows.answers;if(!questions||questions.length===0){return}var findAnswerForQuestion=function(question){if(!question.hasOwnProperty("answer_thread_id")){return null}for(var i=0;i<answers.length;i++){var answer=answers[i];if(parseInt(answer.qa_thread_id)===parseInt(question.answer_thread_id)){return answer}}return null};for(var i=0;i<questions.length;i++){var question=questions[i];if(!question.hasOwnProperty("is_answered")||!question.is_answered){continue}if(!question.hasOwnProperty("locations")||question.locations.length===0){continue}for(var j=0;j<question.locations.length;j++){var location=question.locations[j];var dataBottom=parseInt(location.crop_y+location.crop_height);var mcqBlockerContainer=$(".mcq_blocker_container[data-page='"+location.page_num+"']").filter(function(){return Math.round($(this).data("bottom"))===dataBottom});mcqBlockerContainer=$(mcqBlockerContainer.get(0));if(mcqBlockerContainer.length===1){mcqBlockerContainer.attr("data-is-answered",true);var answer=findAnswerForQuestion(question);if(answer){mcqBlockerContainer.attr("data-explanation",answer["explanation"]);mcqBlockerContainer.attr("data-tutor-user-id",answer["tutor_user_id"]);mcqBlockerContainer.attr("data-tutor-name",answer["tutor_name"])}break}}}resize_document_viewer()};jQuery(document).on("scroll",$.debounce(160,false,loadMCQData));loadMCQData()});function shareDocument(){document.getElementById("share-dropdown").classList.remove("bdp-display-none")}window.onclick=function(event){if(!event.target.matches(".dropbtn")&&!event.target.matches(".dropdown-copy-link")){if(document.getElementById("share-dropdown")){document.getElementById("share-dropdown").classList.add("bdp-display-none")}}};function tweetLink(){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(window.location.href))}function emailLink(){window.open("mailto:?to=&subject="+encodeURIComponent("Check out this awesome document from Course Hero!")+"&body="+encodeURIComponent(window.location.href))}function copyLink(){var docUrl=window.location.href;var el=document.createElement("textarea");el.value=docUrl;document.body.appendChild(el);el.select();document.execCommand("copy");document.body.removeChild(el);document.getElementById("share-copy-link").innerHTML="Link copied!";setTimeout(function(){document.getElementById("share-copy-link").innerHTML="Copy link"},3e3)}function createTrackingQueue(trackingServiceName,trackingMethods){if(window[trackingServiceName]){return}window[trackingServiceName]={queue:[],runTrackingQueue:function(newTrackingService){window[trackingServiceName].queue&&window[trackingServiceName].queue.forEach(function(queuedEvent){try{newTrackingService[queuedEvent.methodName](queuedEvent.eventProperties)}catch(e){console.log("Queued amplitude event dumped:",queuedEvent)}})}};trackingMethods.forEach(function(methodName){window[trackingServiceName][methodName]=function(eventProperties){if(!window[trackingServiceName].queue){window[trackingServiceName][methodName](eventProperties);return}window[trackingServiceName].queue.push({methodName:methodName,eventProperties:eventProperties})}})}function TaxonomyValidationService(){function getCorrectedDeptAcroAndCourseNum(deptAcro,courseNum){deptAcro=deptAcro.toUpperCase();courseNum=courseNum.toUpperCase();var regexStr=/[.&:]/;if(!regexStr.test(deptAcro)&&!regexStr.test(courseNum)){var deptAcroDigitIndex=deptAcro.search(/\d/);var deptAcroAlphaIndex=deptAcro.search(/[A-Z]/);if(deptAcro==courseNum&&deptAcroDigitIndex!=-1&&deptAcroAlphaIndex!=-1){if(deptAcroDigitIndex<deptAcroAlphaIndex){courseNum=courseNum.substring(0,courseNum.search(/[A-Z]/)).trim();deptAcro=deptAcro.substring(deptAcroAlphaIndex).trim()}else{deptAcro=deptAcro.substring(0,deptAcroDigitIndex).trim();courseNum=courseNum.substring(courseNum.search(/\d/)).trim()}}var deptAcroToCheck=deptAcro.match("[0-9]+$");if(deptAcro.indexOf(courseNum)!=-1&&deptAcroToCheck!=null&&courseNum.indexOf(deptAcroToCheck[0])!=-1){deptAcro=deptAcro.substr(0,deptAcro.lastIndexOf(courseNum))}if(courseNum.search(/\d/)==-1||deptAcro.search("[0-9]+[A-Z]+$")!=-1&&courseNum.search(/[A-Z]/)==-1&&deptAcro.substring(0,deptAcro.search(/[A-Z]/))===courseNum){deptAcro=deptAcro.replace(courseNum,"").trim()}courseNum=courseNum.replace(deptAcro,"").trim();if(/^[A-Z]+$/i.test(courseNum)&&/^\d+$/.test(deptAcro)){var temp=courseNum;courseNum=deptAcro;deptAcro=temp}}return{dept:deptAcro,courseNum:courseNum}}function isNewCourseValid(course_name,course_num,dept,school,year,term){var allFieldsValid=course_name&&course_num&&dept&&school&&year&&term;return allFieldsValid&&isDeptAcroCourseNumValid(dept,course_num)}function isDeptAcroCourseNumValid(dept,course_num){course_num=course_num.toUpperCase();dept=dept.toUpperCase();if(dept===course_num&&dept.search(/\d/)!=-1&&dept.search(/[A-Z]/)!=-1){return true}return!(course_num===dept)}return{getCorrectedDeptAcroAndCourseNum:getCorrectedDeptAcroAndCourseNum,isNewCourseValid:isNewCourseValid,isDeptAcroCourseNumValid:isDeptAcroCourseNumValid}}function CourseSelectCtrl($scope,$http,show_saved,add_multiple,required_fields,AbtService,default_school_data,hide_save,TaxonomyValidationService,fromIncorrectTagCtrl){$scope.$on("CourseSelectCtrl.getCourse",function(e,args){courseProp="course";if(args.courseProp){courseProp=args.courseProp}e.targetScope[courseProp]=$scope.course});$scope.addNew=false;$scope.hideSave=hide_save;$scope.requireTitle=Array.isArray(required_fields)&&required_fields.indexOf("title")!=-1;$scope.requireProfessor=Array.isArray(required_fields)&&required_fields.indexOf("professor")!=-1;$scope.default_school_data=default_school_data;$scope.requireLabels=fromIncorrectTagCtrl===undefined||!fromIncorrectTagCtrl;$scope.getCourse=function(course_id){for(var i=0;i<$scope.courseList.length;i++){for(var j=0;j<$scope.courseList[i].courses.length;j++){if($scope.courseList[i].courses[j].course_id==course_id){return $scope.courseList[i].courses[j]}}}return false};$scope.courseInit=function(){$scope.course=$scope.course||{};$scope.course.remember=true;$scope.showSaved=show_saved&&$scope.has_saved_courses;$scope.addMultiple=add_multiple;$scope.course.useSavedCourse=$scope.showSaved;$scope.course.subjects=$scope.course.subjects||[];$scope.course.isTaught=false;if(typeof $scope.autoTagCourseData=="object"&&$scope.autoTagCourseData.course_id&&!$scope.autoSelectCourse){var schoolId=$scope.autoTagCourseData.school_id;var schoolText=$scope.autoTagCourseData.school_name;var schoolType=$scope.autoTagCourseData.school_type;var schoolCountry=$scope.autoTagCourseData.country;$scope.course.school=schoolId+":"+schoolText+":"+schoolType+":"+schoolCountry;$scope.course.labels={field_setting_type:"dept_first"};var courseNum=$scope.autoTagCourseData.course_num;var deptAcro=$scope.autoTagCourseData.dept_acro;$scope.course.course=courseNum+":"+deptAcro;$scope.course.dept=deptAcro;$scope.requireTitle=false;setTimeout(function(){$scope.selectAddNewCourse()},0)}$scope.years=[];$scope.course.show_dept=false;if(!$scope.course.year){$scope.course.year=(new Date).getFullYear()}else{$scope.course.year=parseInt($scope.course.year)}$scope.isInit=0;if(!$scope.course.term){$scope.course.term=1}else{$scope.course.term=parseInt($scope.course.term)}var setCourse=false;var init_course=$scope.course;if($scope.course.courseId){var c=$scope.getCourse($scope.course.courseId);if(c){init_course=c;setCourse=true;$scope.isInit=4}}if(!setCourse&&$scope.course.courseId){$scope.course.useSavedCourse=false;$scope.isInit=4}if(init_course.school_id&&(!$scope.autoTagCourseData||!$scope.autoTagCourseData.school_name)){$scope.course.school=init_course.school_id+":"+init_course.school_name+":"+init_course.school_type;if(typeof init_course.school_country!=="undefined"&&init_course.school_country){$scope.course.school+=":"+init_course.school_country}}if(init_course.course_num){$scope.course.course=init_course.course_num;$scope.course.course_num=init_course.course_num;$scope.course.course_id=init_course.course_num}if(init_course.dept_acro){$scope.course.dept=init_course.dept_acro;$scope.course.dept_acro=init_course.dept_acro;$scope.course.dept_id=init_course.dept_acro}if(init_course.prof_name){$scope.course.professor=init_course.prof_name}else if(typeof $scope.autoTagCourseData=="object"&&$scope.autoTagCourseData.prof_name){$scope.course.professor=$scope.autoTagCourseData.prof_name}else{$scope.course.professor=null}if(init_course.course_name){$scope.course.title=init_course.course_name}else if(typeof $scope.autoTagCourseData=="object"&&$scope.autoTagCourseData.course_name){$scope.course.title=$scope.autoTagCourseData.course_name}else{$scope.course.title=null}if(!init_course.year){$scope.course.year=(new Date).getFullYear()}else{$scope.course.year=parseInt(init_course.year)}if(!init_course.term){$scope.course.term="1"}else{$scope.course.term=init_course.term.toString()}var yearGap=12;for(var i=(new Date).getFullYear();i>=$scope.course.year||i>=(new Date).getFullYear()-yearGap;i--){$scope.years.push(i)}$scope.determineName();$scope.course.labels={college:{label:"School"}}};$scope.selectAddNewCourse=function(){$scope.course.useSavedCourse=0;$scope.isInit=0;$scope.updateCourse()};$scope.$watch("course.courseId",function(newVal,oldVal){if(newVal!=oldVal){$scope.courseInit()}});$scope.updateCourse=function(){$scope.course.title=$scope.validateNewObjectInput($scope.course.title);$scope.course.professor=$scope.validateNewObjectInput($scope.course.professor);$scope.determineName();$scope.determineValidity();$scope.updateLabels();setTimeout(function(){jQuery(window).trigger("resize")},500)};$scope.determineValidity=function(){if($scope.course.useSavedCourse===1){$scope.course.valid=($scope.course.courseId&&$scope.course.courseId>0)>0;return}else{var valid=true;valid=valid&&$scope.course.school&&($scope.course.school.id||$scope.course.school_id);valid=valid&&$scope.course.dept&&($scope.course.dept.id||$scope.course.dept_id);valid=valid&&$scope.course.course&&($scope.course.course.id||$scope.course.course_id);valid=valid&&$scope.course.year;valid=valid&&$scope.course.term;valid=valid&&(!$scope.requireTitle||$scope.course.title||$scope.course.labels&&$scope.course.labels.title&&$scope.course.labels.title.is_hidden);valid=valid&&(!$scope.requireProfessor||$scope.course.professor||$scope.course.professor&&$scope.course.professor.is_hidden);$scope.course.valid=valid!=null&&valid!=false;return}$scope.course.valid=false};$scope.validateInput=function(input){charsToFilter=[/</g,/>/g];var ret=input;charsToFilter.forEach(function(filterRegex){ret=ret.replace(filterRegex,"")});return ret};$scope.validateNewObjectInput=function(obj){if(typeof obj=="object"&&obj!=null){if(obj.new&&obj.hasOwnProperty("id")){obj.id=$scope.validateInput(obj.id);obj.label=obj.id}}else if(typeof obj=="string"){obj=$scope.validateInput(obj)}return obj};$scope.determineName=function(){var dept="";var school="";var num="";if($scope.course.useSavedCourse==true){if($scope.course.myGroup){school=$scope.course.myGroup.school;dept=$scope.course.myGroup.dept;num=$scope.course.myGroup.num}else{$scope.course.displayName="";return}}else{if(typeof $scope.course.school==="object"&&$scope.course.school!==null){if($scope.course.school.label){school=$scope.course.school.label;$scope.course.school_name=school}else{school=$scope.course.school}}if(typeof $scope.course.dept==="object"&&$scope.course.dept!==null){if($scope.course.dept.id){dept=$scope.course.dept.id}else{dept=$scope.course.dept}$scope.course.dept_id=dept;$scope.course.dept_acro=$scope.course.dept.label}if(typeof $scope.course.course=="object"&&$scope.course.course!=null){if($scope.course.course.id){num=$scope.course.course.id}else{num=$scope.course.course}}if(!num&&$scope.course.course_id){num=$scope.course.course_id}if(!dept&&$scope.course.dept_id){dept=$scope.course.dept_id}if($scope.course.course){if($scope.course.course.id){num=$scope.course.course.id}else{num=$scope.course.course}}}};var formatMyGroup=function(selected,grp,escapeMarkup){var data=null;if(grp.element){var originalOption=grp.element;data=jQuery(originalOption).data()}else if(grp.id){data=$scope.getCourse(grp.id);data={dept:data.dept_acro,num:data.course_num,name:data.course_name,school:data.school_name}}else{data=grp}if(selected){$scope.course.myGroup=data;$scope.determineName()}var em=escapeMarkup?escapeMarkup:function(text){return text};if(data&&data.dept){return em(data.dept)+" "+em(data.num)+" - "+em(data.name)+"<br/><span class='select-detail'>"+em(data.school)+" "+em(data.dept)+"</span>"}return em(grp.text)};$scope.myGroupOpts={formatResult:function(grp,container,query,escapeMarkup){return formatMyGroup(false,grp,escapeMarkup)},formatSelection:function(grp,container,escapeMarkup){return formatMyGroup(true,grp,escapeMarkup)},placeholder:"Select Course"};$scope.formatSchool=function(item,container,query,escapeMarkup){var em=escapeMarkup?escapeMarkup:function(text){return text};if(item.location){return em(item.text)+"<br/><span class='select-detail'>"+em(item.location)+"</span>"}return em(item.text)};$scope.schoolFindOpts={placeholder:"Search for a school",minimumInputLength:2,formatResult:$scope.formatSchool,formatSelection:function(i,container,escapeMarkup){if(i instanceof Array&&i.length==0){return $scope.course.school_name}if(typeof i.type==="string"){$scope.course.schoolType=i.type}else{$scope.course.schoolType=i.school_type}return escapeMarkup?escapeMarkup(i.text):i.text},initSelection:function(element,callback){var data=element.val().split(":");var callback_data={id:data[0],text:data[1],label:data[1],school_type:data[2]};if(data.length==4){callback_data.text+=" ("+data[3]+")"}$scope.setSelect2Value(element,callback,callback_data)},ajax:{url:"/ajax/autocomplete_resultset.php?type=school&empty_result=1&detailed=1",dataType:"json",quietMillis:100,data:function(term,page){return{term:term}},results:function(data,page){data=jQuery.map(data,function(i){i["text"]=i["label"]+" ("+i["country"]+")";return i});return{results:data,more:false}}}};if(jQuery().select2.defaults.createSearchChoicePos==undefined&&jQuery().select2.defaults.createSearchChoicePosition==undefined){alert("Updated Version of Select2 detected does not have code to put create new option at the bottom.")}$scope.verifiedcourseFindOpts={placeholder:"Search for a course",minimumInputLength:2,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){var new_wording="Can't find your course?";return{id:term,text:new_wording,new:true}}},formatSelection:function(i,container,escapeMarkup){var result=i.dept_acro+" "+i.id+(i.course_name?" - "+i.course_name:"");return escapeMarkup?escapeMarkup(result):result},initSelection:function(element,callback){var data=element.val().split(":");var callback_data={id:data[0],dept_acro:$scope.course.dept_id,course_name:$scope.course.course_name};$scope.setSelect2Value(element,callback,callback_data)},ajax:{url:"/ajax/autocomplete_resultset.php?type=verified_courses_for_school",dataType:"json",quietMillis:500,data:function(term,page){return{term:term,school:$scope.course.school.id}},results:function(data,page){data=jQuery.map(data,function(i){i["id"]=i["course_num"];i["text"]=i["dept_acro"]+" "+i["course_num"]+(i["label"]?" - "+i["label"]:"");i["courseId"]=i["id"];return i});return{results:data,more:false}}}};$scope.deptFindOpts={placeholder:"Search for a department",minimumInputLength:1,selectOnBlur:true,blurOnChange:true,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){var new_wording="New "+$scope.course.labels.dept.label+":";return{id:term,text:new_wording+term,label:term,new:true}}},initSelection:function(element,callback){var callback_data={};if(element.val()==="[object Object]"&&typeof $scope.course.dept=="object"&&$scope.course.dept!==null){callback_data={id:$scope.course.dept.id||$scope.course.dept.text,text:$scope.course.dept.id||$scope.course.dept.text}}else if(element.val()==="[object Object]"&&$scope.course.dept===null){callback_data={id:"",text:""}}else{callback_data={id:element.val(),text:element.val()}}$scope.setSelect2Value(element,callback,callback_data)},formatSelection:function(i,container,escapeMarkup){if(i.new){i.label=i.id;i.id=i.id;i.text=i.id}return escapeMarkup?escapeMarkup(i.id):i.id},ajax:{url:"/ajax/autocomplete_resultset.php?type=department_schools",dataType:"json",quietMillis:100,data:function(term,page){return{term:term,school:$scope.course.school.id}},results:function(data,page){data=jQuery.map(data,function(i){i["text"]=i["label"];return i});return{results:data,more:false}}},select2_selecting:function(e){},selecting:function(e){},change:function(e){}};$scope.deptFindOpts2={minimumInputLength:1,selectOnBlur:true,blurOnChange:true,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){var new_wording="New "+$scope.course.labels.dept.label+":";return{id:term,text:new_wording+term,label:term,new:true}}},initSelection:function(element,callback){var callback_data={};if(element.val()==="[object Object]"&&typeof $scope.course.dept=="object"){callback_data={id:$scope.course.dept.id||$scope.course.dept.text,text:$scope.course.dept.id||$scope.course.dept.text}}else if(element.val()==="[object Object]"&&$scope.course.dept===null){callback_data={id:"",text:""}}else{callback_data={id:element.val(),text:element.val()}}$scope.setSelect2Value(element,callback,callback_data)},formatSelection:function(i,container,escapeMarkup){if(i.new){i.label=i.id;i.id=i.id;i.text=i.id}return escapeMarkup?escapeMarkup(i.id):i.id},ajax:{url:"/ajax/autocomplete_resultset.php?type=department_schools",dataType:"json",quietMillis:100,data:function(term,page){return{term:term,school:$scope.course.school.id}},results:function(data,page){data=jQuery.map(data,function(i){i["text"]=i["label"];return i});return{results:data,more:false}}},select2_selecting:function(e){},selecting:function(e){},change:function(e){}};$scope.courseFindOpts={minimumInputLength:1,selectOnBlur:true,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){return{id:term,text:"New Course: "+term,label:term,new:true,courseId:0}}},initSelection:function(element,callback){var data=element.val().split(":");var callback_data={id:data[0],text:data[0],name:data[1],prof_name:data[2]};callback(callback_data);$scope.setSelect2Value(element,callback,callback_data)},formatSelection:function(i,container,escapeMarkup){if(i.new){i.label=i.id;i.id=i.id;i.text=i.id}return escapeMarkup?escapeMarkup(i.id):i.id},ajax:{url:"/ajax/autocomplete_resultset.php?type=school_dept_course",dataType:"json",quietMillis:100,data:function(term,page){return{term:term,school:$scope.course.school.id,dept:$scope.course.dept.id}},results:function(data,page){data=jQuery.map(data,function(i){i["courseId"]=i["id"];i["id"]=i["label"];i["text"]=i["label"];return i});return{results:data,more:false}}}};$scope.courseFindOpts2={minimumInputLength:1,selectOnBlur:true,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){return{id:term,text:"New "+$scope.course.labels.course_num.label+": "+term,label:term,new:true,courseId:0}}},initSelection:function(element,callback){var data=element.val().split(":");var callback_data={id:data[0],text:data[0],name:data[1],prof_name:data[2]};$scope.setSelect2Value(element,callback,callback_data)},formatSelection:function(i,container,escapeMarkup){if(i.id)i.id=i.id.replace("$$$$$","");if(i.new){i.id=i.id;i.text=i.id}if(i.label==null){if($scope.course.dept_acro!=null)i.label=$scope.course.dept_acro+i.id;else if($scope.course.dept!=null){if($scope.course.dept.id!=null){i.label=$scope.course.dept.id+i.id}else i.label=$scope.course.dept+i.id}}return escapeMarkup?escapeMarkup(i.label):i.label},ajax:{url:"/ajax/autocomplete_resultset.php?type=course2",dataType:"json",quietMillis:100,data:function(term,page){return{term:term,school:$scope.course.school.id}},results:function(data,page){data=jQuery.map(data,function(i){i["courseId"]=i["course_id"];i["id"]=i["course_num"]+"$$$$$";var prof_name="";var course_name="";if(!(i["prof_name"]==""||i["prof_name"]==null||$.trim(i["prof_name"])==""))prof_name="("+i["prof_name"]+")";if(!(i["course_name"]==""||i["course_name"]==null||$.trim(i["course_name"])==""))course_name=":"+i["course_name"];i["text"]=i["dept_acro"]+""+i["course_num"]+course_name+prof_name;i["label"]=i["dept_acro"]+""+i["course_num"];return i});return{results:data,more:false}}}};$scope.titleFindOpts={placeholder:"e.g. Introduction to Microeconomics",minimumInputLength:1,selectOnBlur:true,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){return{id:term,text:"New Title: "+term,new:true}}},initSelection:function(element,callback){var data;if(element.val()==="[object Object]"){data=$scope.course.title.id}else{data=element.val()}var callback_data={id:data,text:data,label:data};$scope.setSelect2Value(element,callback,callback_data)},formatSelection:function(i,container,escapeMarkup){if(i.new){i.label=i.id;i.id=i.id;i.text=i.id}return escapeMarkup?escapeMarkup(i.id):i.id},ajax:{url:"/ajax/autocomplete_resultset.php?type=school_dept_course_title",dataType:"json",quietMillis:100,data:function(term,page){return{term:term,school:$scope.course.school.id,dept:$scope.course.dept.id}},results:function(data,page){data=jQuery.map(data,function(i){i["id"]=i["label"];i["text"]=i["label"];return i});return{results:data,more:false}}}};$scope.professorFindOpts={minimumInputLength:1,selectOnBlur:true,createSearchChoicePos:"bottom",createSearchChoicePosition:"bottom",createSearchChoice:function(term,data){if(jQuery(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){return{id:term,text:"New "+$scope.course.labels.professor.label+": "+term,new:true}}},initSelection:function(element,callback){var data=element.val();var callback_data={id:data,text:data,label:data};$scope.setSelect2Value(element,callback,callback_data)},formatSelection:function(i,container,escapeMarkup){if(i.new){i.label=i.id;i.id=i.id;i.text=i.id}return escapeMarkup?escapeMarkup(i.text):i.text},ajax:{url:"/ajax/autocomplete_resultset.php?type=school_dept_professor",dataType:"json",quietMillis:100,data:function(term,page){return{term:term,school:$scope.course.school.id,dept:$scope.course.dept.id}},results:function(data,page){data=jQuery.map(data,function(i){i["id"]=i["label"];i["text"]=i["label"];return i});return{results:data,more:false}}}};$scope.termOption={};$scope.yearOption={};$scope._handle_inter_get_labels_success=function(data){$scope.course.labels=data;$scope.deptFindOpts.placeholder=$scope.course.labels.dept.place_holder;$scope.courseFindOpts.placeholder=$scope.course.labels.course_num.place_holder;$scope.deptFindOpts2.placeholder=$scope.course.labels.dept.place_holder;$scope.courseFindOpts2.placeholder=$scope.course.labels.course_num.place_holder;$scope.titleFindOpts.placeholder=$scope.course.labels.title.place_holder;$scope.professorFindOpts.placeholder=$scope.course.labels.professor.place_holder;$scope.termOption.placeholder=$scope.course.labels.term.place_holder;$scope.yearOption.placeholder=$scope.course.labels.year.place_holder;var x=$scope.index;if($scope.index==undefined){x=""}if(typeof $("[name=select2_course_num"+x+"]").select2!="undefined"){$("[name=select2_course_num"+x+"]").select2($scope.courseFindOpts);$("[name=select2_dept"+x+"]").select2($scope.deptFindOpts);$("[name=select2_course_title"+x+"]").select2($scope.titleFindOpts);$("[name=select2_professor"+x+"]").select2($scope.professorFindOpts);$("[name=select2_course_num2"+x+"]").select2($scope.courseFindOpts2);$("[name=select2_dept2"+x+"]").select2($scope.deptFindOpts2);$("[name=select2_course_title2"+x+"]").select2($scope.titleFindOpts);$("[name=select2_professor2"+x+"]").select2($scope.professorFindOpts);$("[name=select2_term2"+x+"]").select2($scope.termOption);$("[name=select2_year2"+x+"]").select2($scope.yearOption);$("[name=select2_term"+x+"]").select2($scope.termOption);$("[name=select2_year"+x+"]").select2($scope.yearOption)}};inter_labels=typeof inter_labels=="undefined"?[]:inter_labels;var labelLock=false;$scope.updateLabels=function(){if(!$scope.requireLabels){return}if(typeof $scope.course.school!=="undefined"&&$scope.course.school){if(typeof $scope.course.school.country!=="undefined"&&$scope.course.school.country){$scope.course.school_country=$scope.course.school.country}var url="/ajax/inter_get_labels.php?country_name="+$scope.course.school_country+"&group_name=uploader&school_type="+$scope.course.schoolType+"&school_name="+$scope.course.school.label;var school_labels_index="country="+$scope.course.school_country+"&type="+$scope.course.schoolType+"&name="+$scope.course.school.label}if(school_labels_index in inter_labels){$scope._handle_inter_get_labels_success(inter_labels[school_labels_index])}else if(typeof url!=="undefined"&&!labelLock){labelLock=true;$http({method:"GET",url:url}).success(function(data){inter_labels[school_labels_index]=data;$scope._handle_inter_get_labels_success(data);labelLock=false}).error(function(data,status,headers,config){labelLock=false})}};$scope.schoolChanged=function(callback){if(!$scope.isInit){$scope.course.dept=null;$scope.course.course=null;$scope.course.professor=null;$scope.course.title=null;$scope.course.term=null;$scope.course.year=null}else if($scope.isInit>0){$scope.isInit--}$scope.updateCourse();if($scope.course.school.document_count<200){$scope.addNew=true}else{$scope.addNew=false}if(callback&&typeof callback==="function"){callback()}};$scope.deptChanged=function(){if(!$scope.isInit){$scope.course.course=null;$scope.course.dept=$scope.validateNewObjectInput($scope.course.dept);$scope.updateCourse();$scope.course.title=null;$scope.course.professor=null;$scope.course.term=null;$scope.course.year=null}else if($scope.isInit>0){$scope.isInit--}};$scope.courseinfoChanged=function(){if(!$scope.course.course.dept_acro&&$scope.course.course.id&&!$scope.addNew){$scope.addNew=true;$scope.course.course=null;$scope.course.dept=null;$scope.course.title=null;$scope.updateCourse()}if(!$scope.addNew){$scope.course.dept={id:$scope.course.course.dept_acro};$scope.courseChanged()}};$scope.resetCourse=function(){$scope.course.courseId=null;$scope.course.title=null;$scope.course.school=null;$scope.course.dept=null;$scope.course.course=null;$scope.course.professor=null;$scope.course.valid=false;$scope.course.displayName=null};$scope.deptChanged2=function(){$scope.updateCourse()};var haveAutoTagCourseName=function(){return!$scope.autoSelectCourse&&typeof $scope.autoTagCourseData=="object"&&$scope.autoTagCourseData.course_name};$scope.courseChanged=function(){if(!$scope.isInit){if(haveAutoTagCourseName()){$scope.course.title=$scope.autoTagCourseData.course_name}else{$scope.course.title=null}$scope.course.professor=null;$scope.course.term=null;$scope.course.year=null;$scope.course.course=$scope.validateNewObjectInput($scope.course.course);if(typeof $scope.course.course=="string"||$scope.course.course instanceof String){}else{if($scope.course.course.new){var month=(new Date).getMonth();if($scope.course.labels&&$scope.course.labels.term.options[1]=="Fall"&&$scope.course.labels.term.options[2]=="Winter"&&$scope.course.labels.term.options[3]=="Spring"&&$scope.course.labels.term.options[4]=="Summer"){$scope.course.term=getCurrentTerm(month)}else{$scope.course.term="1"}$scope.course.year=(new Date).getFullYear()}else{if($scope.course.course.course_name!=null&&$scope.course.course.course_name!="")$scope.course.title={label:$scope.course.course.course_name,id:$scope.course.course.course_name,text:$scope.course.course.course_name};if($scope.course.course.prof_name!=null&&$scope.course.course.prof_name!=""){$scope.course.professor={label:$scope.course.course.prof_name,id:$scope.course.course.prof_name,text:$scope.course.course.prof_name}}if($scope.course.course.term!=null&&$scope.course.course.term!=""){$scope.course.term=$scope.course.course.term}else{var month=(new Date).getMonth();if($scope.course.labels.term&&$scope.course.labels.term.options[1]=="Fall"&&$scope.course.labels.term.options[2]=="Winter"&&$scope.course.labels.term.options[3]=="Spring"&&$scope.course.labels.term.options[4]=="Summer"){$scope.course.term=getCurrentTerm(month)}else{$scope.course.term="1"}}if($scope.course.course.year!=null&&$scope.course.course.year!=""){$scope.course.year=$scope.course.course.year}else{$scope.course.year=(new Date).getFullYear()}}}}else if($scope.isInit>0){$scope.isInit--}$scope.updateCourse()};$scope.courseChanged2=function(){var x=$scope.index;if($scope.index==undefined){x=""}if(!$scope.isInit){$scope.course.dept=null;if(haveAutoTagCourseName()){$scope.course.title=$scope.autoTagCourseData.course_name}else{$scope.course.title=null}$scope.course.professor=null;$scope.course.term=null;$scope.course.year=null;if(typeof $scope.course.course=="string"||$scope.course.course instanceof String){}else{if($scope.course.course.new){var formated_strings=$scope.course.course.id.split(":");if(formated_strings.length>1){$scope.course.course.id=formated_strings[0];if(formated_strings[1].trim()!=""){$scope.course.title={label:formated_strings[1],id:formated_strings[1],text:formated_strings[1]}}}var course_num=$scope.course.course.id;var course_num1=course_num;var dept_acro=null;if(/[a-zA-Z][0-9]/.test(course_num)){var xx=1;for(;xx<course_num.length;xx++)if(/[a-zA-Z][0-9]/.test(course_num.substring(0,xx)))break;course_num1=course_num.substring(xx-1,course_num.length);dept_acro=course_num.substring(0,xx-1);if(formated_strings.length>1&&formated_strings[1].trim()!=""){$("[name=select2_professor2"+x+"]").select2("focus");$("[name=select2_professor2"+x+"]").select2("open")}else{$("[name=select2_course_title2"+x+"]").select2("focus");$("[name=select2_course_title2"+x+"]").select2("open")}}else if(/[0-9][a-zA-Z]/.test(course_num)){var xx=1;for(;xx<course_num.length;xx++)if(/[0-9][a-zA-Z]/.test(course_num.substring(0,xx)))break;course_num1=course_num;dept_acro=course_num.substring(xx-1,course_num.length);if(formated_strings.length>1&&formated_strings[1].trim()!=""){$("[name=select2_professor2"+x+"]").select2("focus");$("[name=select2_professor2"+x+"]").select2("open")}else{$("[name=select2_course_title2"+x+"]").select2("focus");$("[name=select2_course_title2"+x+"]").select2("open")}}else{$scope.show_dept=true}if(dept_acro!=null)$scope.course.dept={label:dept_acro,id:dept_acro,text:dept_acro};$scope.course.course={label:course_num,id:course_num1,text:course_num};var month=(new Date).getMonth();if($scope.course.labels.term.options[1]=="Fall"&&$scope.course.labels.term.options[2]=="Winter"&&$scope.course.labels.term.options[3]=="Spring"&&$scope.course.labels.term.options[4]=="Summer"){$scope.course.term=getCurrentTerm(month)}else{$scope.course.term="1"}$scope.course.year=(new Date).getFullYear()}else{if($scope.course.course.dept_acro!=null&&$scope.course.course.dept_acro!="")$scope.course.dept={label:$scope.course.course.dept_acro,id:$scope.course.course.dept_acro,text:$scope.course.course.dept_acro};if($scope.course.course.course_name!=null&&$scope.course.course.course_name!="")$scope.course.title={label:$scope.course.course.course_name,id:$scope.course.course.course_name,text:$scope.course.course.course_name};else{$("[name=select2_course_title2"+x+"]").select2("focus")}if($scope.course.course.prof_name!=null&&$scope.course.course.prof_name!=""){$scope.course.professor={label:$scope.course.course.prof_name,id:$scope.course.course.prof_name,text:$scope.course.course.prof_name}}else if($scope.course.course.course_name!=null&&$scope.course.course.course_name!=""){$("[name=select2_professor2"+x+"]").select2("focus")}if($scope.course.course.year!=null&&$scope.course.course.year!=""){$scope.course.year=$scope.course.course.year}else{$("[name=select2_term2"+x+"]").select2("focus");var month=(new Date).getMonth();if($scope.course.labels.term&&$scope.course.labels.term.options[1]=="Fall"&&$scope.course.labels.term.options[2]=="Winter"&&$scope.course.labels.term.options[3]=="Spring"&&$scope.course.labels.term.options[4]=="Summer"){$scope.course.term=getCurrentTerm(month)}else{$scope.course.term="1"}if($scope.autoTagCourseData&&!$scope.autoSelectCourse){var month=(new Date).getMonth();$scope.course.term=getCurrentTerm(month)}}if($scope.course.course.term!=null&&$scope.course.course.term!=""){$scope.course.term=$scope.course.course.term}else{$("[name=select2_year2"+x+"]").select2("focus");$scope.course.year=(new Date).getFullYear()}}}}else if($scope.isInit>0){$scope.isInit--}$scope.updateCourse()};$scope.resetCourse=function(){$scope.course.courseId=null;$scope.course.title=null;$scope.course.school=null;$scope.course.dept=null;$scope.course.course=null;$scope.course.professor=null;$scope.course.valid=false;$scope.course.displayName=null;$scope.course.subjects={}};$scope.tagToCourse=function(){$scope.determineValidity();if(!$scope.course.valid){return}if($scope.course.useSavedCourse==true){$scope.course.displayName=$scope.course.school_name+" - "+$scope.course.dept_acro+" "+$scope.course.course_num;$scope.course.displayNameShort=$scope.course.dept_acro+" "+$scope.course.course_num;$scope.$emit("CourseSelectCtrl.tag",{courseId:$scope.course.courseId,name:$scope.course.displayName});$scope.course.courseId=null;$scope.resetCourse()}else{var courseData={};courseData.schoolId=$scope.course.school.id;courseData.departmentAcronym=$scope.course.dept.id||$scope.course.dept;courseData.courseNum=$scope.course.course.id;var deptAndCourseNum=TaxonomyValidationService.getCorrectedDeptAcroAndCourseNum(courseData.departmentAcronym,courseData.courseNum);courseData.departmentAcronym=deptAndCourseNum.dept;courseData.courseNum=deptAndCourseNum.courseNum;courseData.courseTitle=$scope.course.title;courseData.courseYear=$scope.course.year;courseData.courseTerm=$scope.course.term;if($scope.course.professor){courseData.professor=$scope.course.professor.id}courseData.remember=$scope.course.remember;$http({method:"POST",url:"/api/v1/courses/",data:courseData}).success(function(data,status,headers,config){$scope.course.displayName=$scope.course.school_name+" - "+courseData.departmentAcronym+" "+courseData.courseNum;$scope.course.displayNameShort=courseData.departmentAcronym+" "+courseData.courseNum;$scope.$emit("CourseSelectCtrl.tag",{courseId:data,name:$scope.course.displayName});$scope.resetCourse();if(jQuery("#my-newsfeed-content").html()&&jQuery("#my-newsfeed-content").html().length){jQuery("#my-newsfeed-content").html("")}}).error(function(data,status,headers,config){alert("An error occurred adding the course, please refresh and try again.")})}};$scope.$on("changeCourseSelectorSchool",function(event,data){$scope.course.school_id=data.id;$scope.course.school_name=data.label;$scope.course.school_type=data.type;$scope.course.school=data.id+":"+data.label+":"+data.type;$scope.courseInit()});$scope.$on("setCourseSelectCtrlDetails",function(event,data){$scope.showSaved=true;$scope.course.school_id=data.school_id;$scope.course.school_name=data.school_name;$scope.course.courseId=data.course_id;$scope.courseInit()});$scope.saveCurrentCourseState=function(){var previous_state={};var properties_to_save=["courseId"];previous_state["useSavedCourse"]=parseInt($scope.course.useSavedCourse);previous_state["courseId"]=$scope.course.courseId;if(!previous_state["useSavedCourse"]){previous_state["school"]={};if(typeof $scope.course.school=="object"&&$scope.course.school!=null){previous_state["school"]["id"]=$scope.course.school.id;previous_state["school"]["label"]=$scope.course.school.label;previous_state["school"]["text"]=$scope.course.school.text;previous_state["school"]["type"]=$scope.course.school.type}previous_state["dept"]={};if(typeof $scope.course.dept=="object"&&$scope.course.dept!=null){previous_state["dept"]["id"]=$scope.course.dept.id;previous_state["dept"]["label"]=$scope.course.dept.label;previous_state["dept"]["text"]=$scope.course.dept.text;previous_state["dept"]["new"]=$scope.course.dept.new}previous_state["professor"]={};if(typeof $scope.course.professor=="object"&&$scope.course.professor!=null){previous_state["professor"]["id"]=$scope.course.professor.id;previous_state["professor"]["label"]=$scope.course.professor.label;previous_state["professor"]["text"]=$scope.course.professor.text;previous_state["professor"]["new "]=$scope.course.professor.new}previous_state["course"]={};if(typeof $scope.course.course=="object"&&$scope.course.course!=null){previous_state["course"]["id"]=$scope.course.course.id||$scope.course.course_id;previous_state["course"]["label"]=$scope.course.course.label;previous_state["course"]["text"]=$scope.course.course.text;previous_state["course"]["new "]=$scope.course.course.new;previous_state["course"]["courseId "]=$scope.course.course.courseId}previous_state["title"]={};if(typeof $scope.course.title=="object"&&$scope.course.title!=null){previous_state["title"]["id"]=$scope.course.title.id;previous_state["title"]["label"]=$scope.course.title.label;previous_state["title"]["text"]=$scope.course.title.text;previous_state["title"]["new"]=$scope.course.title.new}previous_state["term"]=$scope.course.term;previous_state["year"]=$scope.course.year}if(typeof $scope.course.subjects=="object"&&$scope.course.subjects!=null){previous_state["subjects"]=$scope.course.subjects;previous_state["subjectNames"]=$scope.course.subjectNames}$scope.previous_state=previous_state;$scope.course.has_previous_state=true};$scope.$on("openCourseWidget",function(event,data){if(data==$scope.course){$scope.saveCurrentCourseState();$scope.course.useSavedCourse=0;$scope.isInit=0}});$scope.$on("cleanPreviousState",function(event){$scope.course.has_previous_state=false;$scope.previous_state={}});$scope.$on("revertToPreviousState",function(event,data){if($scope.course.has_previous_state&&data==$scope.course){var previous_state=$scope.previous_state;if($scope.previous_state.useSavedCourse){$scope.course.courseId=$scope.previous_state.courseId;$scope.courseInit()}else{$scope.course.school=previous_state["school"];$scope.course.dept=previous_state["dept"];$scope.course.course=previous_state["course"];$scope.course.title=previous_state["title"];$scope.course.professor=previous_state["professor"];$scope.course.term=previous_state["term"];$scope.course.year=previous_state["year"];$scope.skipSchoolChanged=1;$scope.skipDeptChanged=1;$scope.skipCourseChanged=1;$scope.course.useSavedCourse=0;$scope.updateCourse()}if(typeof previous_state["subjects"]=="object"&&previous_state["subjects"]!=null){$scope.course.subjects=[];for(var i=0;i<previous_state["subjects"].length;i++){$scope.course.subjects.push($scope.subjectList[previous_state["subjects"][i]].category_id)}$scope.course.subjectNames=previous_state["subjectNames"]}$scope.course.has_previous_state=false;$scope.previous_state={};$scope.updateCourse()}});$scope.setSelect2Value=function(element,callback,callback_data){callback(callback_data)}}function getCurrentTerm(month){if(month==0){return"2"}else if(month<5){return"3"}else if(month<7){return"4"}else{return"1"}}var ProductThumbnailStats=new function(){return{dispatchView:function(action,payload){payload.action=action;this.dispatcher.dispatch(ProductThumbnailStats.dispatcher.type.VIEW,payload)},dispatchServer:function(action,payload){payload.action=action;this.dispatcher.dispatch(ProductThumbnailStats.dispatcher.type.SERVER,payload)}}};ProductThumbnailStats.dispatcher=new function(){return{callbacks:[],dispatch:function(type,payload){this.callbacks.forEach(function(callback){if(typeof callback==="function"){callback(payload)}})},register:function(callback){this.callbacks.push(callback);return this.callbacks.length-1},unregister:function(index){if(typeof this.callbacks[index]!=="undefined"){this.callbacks[index]=null}},type:{VIEW:"ProductThumbnailStats.dispatcher.type.VIEW",SERVER:"ProductThumbnailStats.dispatcher.type.SERVER"}}};ProductThumbnailStats.actions={RECEIVE:"ProductThumbnailStats.actions.RECEIVE",FAILURE:"ProductThumbnailStats.actions.FAILURE"};ProductThumbnailStats.events={UPDATE:"ProductThumbnailStats.events.UPDATE",FAILURE:"ProductThumbnailStats.events.FAILURE"};ProductThumbnailStats.store=new function(){var $=jQuery;return{products:[],dispatchIndex:ProductThumbnailStats.dispatcher.register(function(payload){switch(payload.action){case ProductThumbnailStats.actions.RECEIVE:payload.products.forEach(function(product){if(typeof ProductThumbnailStats.store.products[product.type]==="undefined"){ProductThumbnailStats.store.products[product.type]={}}ProductThumbnailStats.store.products[product.type][product.id]=product});$(window).trigger(ProductThumbnailStats.events.UPDATE);break;case ProductThumbnailStats.actions.FAILURE:$(window).trigger(ProductThumbnailStats.events.FAILURE);break}}),getAll:function(){return this.products}}};ProductThumbnailStats.api=new function(){var $=jQuery;function onReceive(response){if(response.error){var message="Received error response from server";if(JSON&&JSON.stringify){message+=": "+JSON.stringify(response)}throw new Error(message)}if(response.products===undefined){throw new Error("No products returned from server")}ProductThumbnailStats.dispatchServer(ProductThumbnailStats.actions.RECEIVE,{products:response.products})}function onError(err){ProductThumbnailStats.dispatchServer(ProductThumbnailStats.actions.FAILURE,{})}var API_PULL_URL="/api/v1/meta-data/";return{getStats:function(products){if(typeof products==="undefined"||products.length===0){return false}var existing=ProductThumbnailStats.store.getAll();var unique=products.filter(function(a){return typeof existing[a.type]==="undefined"||typeof existing[a.type][a.id]==="undefined"});if(unique.length===0){return false}var data={products:unique};$.ajax({url:API_PULL_URL,type:"POST",data:data,dataType:"json",success:onReceive,error:onError})}}};ProductThumbnailStats.app=new function(){var $=jQuery;return{start:function(){$(window).on(ProductThumbnailStats.events.UPDATE,function(){var products=ProductThumbnailStats.store.getAll();for(var type in products){products[type].forEach(function(product){$('.js-enable-product-stats:[data-product-id="'+product.id+'"][data-product-type="'+product.type+'"] span:[data-product-stat]').each(function(_,stat){var stat_type=$(stat).data("product-stat");if(typeof product[stat_type]!=="undefined"){var html=$(stat).children();$(stat).html(html);$(stat).append(document.createTextNode(" "+product[stat_type]))}})})}});$(window).on(ProductThumbnailStats.events.FAILURE,function(){$(".js-enable-product-stats span:[data-product-stat]").hide()});this.fromDOM()},fromDOM:function(){var products=[];$(".js-enable-product-stats").each(function(_,stats){products.push({type:$(stats).data("product-type"),id:$(stats).data("product-id")})});ProductThumbnailStats.api.getStats(products)},startAngular:function(){}}};if(typeof ProductThumbnailStatsServices==="undefined"){throw new Error("ProductThumbnailStatsServices is required to use this class")}var productThumbnailStatsService=ProductThumbnailStatsServices.service("productThumbnailStatsService",function(){var thumbnailService={getStats:function(){return ProductThumbnailStats.store.getAll()},getStat:function(statsObject,stat,type,id){if(typeof statsObject[type]!=="undefined"&&typeof statsObject[type][id]!=="undefined"){if(statsObject[type][id][stat]==0){return"~"}return statsObject[type][id][stat]}return"~"}};return thumbnailService});if(typeof angular==="undefined"){throw new Error("Angular is required to use the newsfeed services")}var ProductThumbnailStatsServices=angular.module("ProductThumbnailStatsServices",[]);var BasicDocLanding=angular.module("BasicDocLanding",["ui","ui.select","ngSanitize","ngAnimate","searchServices","contentServices","userPublicProfileServices"]);BasicDocLanding.config(function($interpolateProvider){$interpolateProvider.startSymbol("{[").endSymbol("]}")});BasicDocLanding.controller("IncorrectTagCtrl",function($scope,$http,TaxonomyValidationService){return new IncorrectTagCtrl($scope,$http,TaxonomyValidationService)});BasicDocLanding.service("TaxonomyValidationService",TaxonomyValidationService);function IncorrectTagCtrl($scope,$http,TaxonomyValidationService){CourseSelectCtrl($scope,$http,true,true,["title"],undefined,undefined,undefined,TaxonomyValidationService,true);$scope.init=function(course,title,documentType,documentTypes,retagUrl){$scope.course=course;$scope.title=title;$scope.retagUrl=retagUrl;$scope.documentType=documentType;$scope.documentTypes=documentTypes;$scope.courseInit();$scope.isInit=3;$scope.alreadySubmittedEdit=false};$scope.getData=function(){var data={};data.schoolName=$scope.course.school.label;var deptAndCourseNum=TaxonomyValidationService.getCorrectedDeptAcroAndCourseNum(getObjectValue($scope.course.dept),getObjectValue($scope.course.course));setDeptAndCourseNum(deptAndCourseNum.dept,deptAndCourseNum.courseNum);data.deptAcro=getObjectValue($scope.course.dept);data.courseNum=getObjectValue($scope.course.course);data.courseName=getObjectValue($scope.course.title);data.year=$scope.course.year;data.semester=$scope.course.term;if($scope.course.professor){data.profName=getObjectValue($scope.course.professor.text)}data.documentType=$scope.documentType;data.documentTitle=$scope.title;return data};$scope.submit=function(){if($scope.canSubmit()){var retagData=$scope.getData();$http({method:"POST",url:$scope.retagUrl,responseType:"json",data:{incorrect_doc_tag:retagData}}).success(function(data){$scope.originalCourse=null;$scope.alreadySubmittedEdit=true;$scope.close();sweetAlert("Thanks for your edits!","","success")})}};$scope.setAlreadySubmittedEdit=function(){$scope.alreadySubmittedEdit=true};$scope.close=function(){var magnificPopup=$.magnificPopup.instance;if(magnificPopup){magnificPopup.close()}if($scope.originalCourse){$scope.course.school=$scope.originalCourse.school;$scope.course.dept=$scope.originalCourse.dept;$scope.course.course=$scope.originalCourse.course;$scope.course.title=$scope.originalCourse.title;$scope.course.term=$scope.originalCourse.term;$scope.course.professor=$scope.originalCourse.professor;$scope.course.year=$scope.originalCourse.year;$scope.course.semester=$scope.originalCourse.semester;$scope.title=$scope.originalTitle;$scope.documentType=$scope.originalDocumentType;$scope.updateLabels();$scope.originalCourse=null}$scope.requireLabels=false};$scope.setFormPristine=function(){$scope.documentRetagForm.$setPristine()};$scope.open=function(){$scope.originalCourse=angular.copy($scope.course);$scope.originalTitle=$scope.title;$scope.originalDocumentType=$scope.documentType;$scope.requireLabels=true;$scope.updateLabels();$scope.setFormPristine();$.magnificPopup.open({items:{src:"#ch_tagging_container",type:"inline"},enableEscapeKey:false})};$scope.canSubmit=function(){return $scope.documentRetagForm.$dirty&&$scope.documentRetagForm.$valid};$scope.setSelect2Value=function(element,callback,callback_data){var elementField=null;var formFieldNameId=$(element).attr("name");if(formFieldNameId&&$scope.documentRetagForm&&$scope.documentRetagForm.hasOwnProperty(formFieldNameId)){elementField=$scope.documentRetagForm[formFieldNameId]}var oldPristineValue=null;var oldValue=null;if(elementField){oldPristineValue=elementField.$pristine;oldValue=getObjectValue(elementField.$modelValue)}callback(callback_data);if(elementField){var newPristineValue=elementField.$pristine;var newValue=getObjectValue(elementField.$modelValue);var callbackValue=getObjectValue(callback_data);if(callbackValue!==newValue){newPristineValue=false;newValue=callbackValue}if(oldPristineValue!==newPristineValue&&angular.equals(oldValue,newValue)){if(oldPristineValue){elementField.$setPristine();if(isFormPristine($scope.documentRetagForm)){$scope.setFormPristine()}}}}};function isFormPristine(form){if(form){if(!form.$pristine){for(var field in form){if(form.hasOwnProperty(field)&&field[0]!=="$"&&!form[field].$pristine){return false}}}return true}return false}function getObjectValue(objOrValue){if(objOrValue!==null&&typeof objOrValue=="object"){return objOrValue.id}else if(typeof objOrValue=="string"){return objOrValue}return null}function setDeptAndCourseNum(dept,courseNum){if($scope.course.dept!==null&&typeof $scope.course.dept=="object"){$scope.course.dept.id=dept}else{$scope.course.dept=dept}if($scope.course.courseNum!==null&&typeof $scope.course.courseNum=="object"){$scope.course.courseNum.id=courseNum}else{$scope.course.courseNum=courseNum}}}var closeSnackBar=function(e){$("#snackBar").addClass("isHidden")};var closePrompt=function(e){$("#prompt").removeClass("isActive")};var switchTab=function(e,tabName){var bookmarked=document.getElementById("bookmarked");var recentlyViewed=document.getElementById("recentlyViewed");var bookmarkedTab=document.getElementById("bookmarkedTab");var recentlyViewedTab=document.getElementById("recentlyViewedTab");if(tabName=="bookmarked"){bookmarked.style.display="block";recentlyViewed.style.display="none";bookmarkedTab.className="isSelected";recentlyViewedTab.className=""}else{bookmarked.style.display="none";recentlyViewed.style.display="block";bookmarkedTab.className="";recentlyViewedTab.className="isSelected"}};var emptyStateMessage=function(e,action){var beforeHover=document.getElementById("beforeHover");var duringHover=document.getElementById("duringHover");var afterClick=document.getElementById("afterClick");if(action=="beforeHover"){if(_docLandingProps.isDesktop&&afterClick){beforeHover.style.display="block";duringHover.style.display="none";afterClick.style.display="none"}}else if(action=="afterClick"){beforeHover.style.display="none";duringHover.style.display="none";afterClick.style.display="block"}else{if(afterClick.style.display!="block"){beforeHover.style.display="none";duringHover.style.display="block";afterClick.style.display="none"}}};$(document).ready(function(){var wrapper=$("#bookmark_empty_wrapper");wrapper.on("mouseover",function(event){emptyStateMessage(event,"duringHover")});wrapper.on("mouseout",function(event){emptyStateMessage(event,"beforeHover")});wrapper.on("mousedown",function(event){emptyStateMessage(event,"afterClick")});var bookmarkedTab=$("#bookmarkedTab");bookmarkedTab.on("click",function(event){switchTab(event,"bookmarked")});var recentlyViewedTab=$("#recentlyViewedTab");recentlyViewedTab.on("click",function(event){switchTab(event,"recentlyViewed")})});$(document).ready(function(){var trackingProperties={};var properties={};var conversionName="";var breadcrumbName="";var targetUrl="";var documentInfo={};if(typeof tracker!=="undefined"){trackingProperties=tracker.getDocumentInfo(window.location.pathname);jQuery.extend(tracker.super_properties,trackingProperties);jQuery("[data-ch-mixpanel-conversion-tracking]").on("click",function($event){properties={};conversionName=jQuery($event.delegateTarget).attr("data-ch-mixpanel-conversion-tracking");if(conversionName){properties["Conversion Name"]=conversionName}});jQuery("[data-ch-mixpanel-amplitude-tracking]").on("click",function(){if(window.amplitudeService){window.amplitudeService.trackCtaClicked({actionType:"Secondary",text:"Edit Document",intent:"Edit Document",xpath:"Locked Document"})}});jQuery("[data-ch-mixpanel-breadcrumb-tracking]").on("click",function($event){properties={};breadcrumbName=jQuery($event.delegateTarget).attr("data-ch-mixpanel-breadcrumb-tracking");if(breadcrumbName){properties["Breadcrumb Name"]=breadcrumbName}});jQuery(".bdp_related_carousel_container .ch_product_document").on("click",function($event){properties={};targetUrl=jQuery($event.delegateTarget).attr("href");if(targetUrl){documentInfo=tracker.getDocumentInfo(targetUrl);properties["Target File"]=documentInfo["Page Type"]==="Split"?documentInfo["Split Hash"]:documentInfo["DB Filename"]}properties.Section="Related Docs"});jQuery("#ch-header_secondary-nav_wrapper form").on("submit",function($event){properties={};properties.Query=jQuery($event.delegateTarget).find("input[name='stx']").val()})}});if(typeof angular==="undefined"){throw new Error("Angular must be included in order to use userPublicProfileServices")}var userPublicProfileServices=angular.module("userPublicProfileServices",["utilServices"]);var contentServices=angular.module("contentServices",["utilServices","content.widget.flag.reasons-service"]);contentServices.config(["$interpolateProvider","$locationProvider",function($interpolateProvider,$locationProvider){$interpolateProvider.startSymbol("{[").endSymbol("]}")}]);(function(){var app=angular.module("content.widget.flag.reasons-service",[]);app.service("ContentWidgetFlagReasonsService",function(){var TYPE_ALL="all";var TYPE_FLAG="flag";var TYPE_REVIEW="review";function getSecondaryReasonsMap(){"use strict";var reasons=getReasons();var oldFormatSecondaryReasons={};for(var i=0;i<reasons.length;i++){var reason=reasons[i];if(reason.secondaryReasons&&reason.secondaryReasons.length>0){for(var j=0;j<reason.secondaryReasons.length;j++){var secondaryReason=reason.secondaryReasons[j];oldFormatSecondaryReasons[secondaryReason.key]=secondaryReason.label}}}return oldFormatSecondaryReasons}function getReasons(){"use strict";return[{key:"academic_integrity",label:"It has poor academic integrity",type:TYPE_FLAG,secondaryReasons:[]},{key:"infringes_rights",label:"It infringes my rights",type:TYPE_FLAG,secondaryReasons:[{key:"copyright",label:"Copyright infringement",hasOther:false},{key:"privacy",label:"Privacy violation",hasOther:false},{key:"legal",label:"Other legal matter (please specify)",hasOther:true}]},{key:"no_answer",label:"It doesnt include answers",type:TYPE_ALL,secondaryReasons:[]},{key:"information",label:"It contains incorrect information",type:TYPE_ALL,secondaryReasons:[{key:"question_answer",label:"Inaccurate questions or answers",hasOther:false},{key:"title_thumbnail",label:"Inaccurate title or thumbnail",hasOther:false},{key:"irrelevant_course",label:"Irrelevant to this course",hasOther:false}]},{key:"quality",label:"It is poor quality",type:TYPE_ALL,secondaryReasons:[{key:"blank",label:"No value or blank content",hasOther:false},{key:"spelling",label:"Spelling or grammar mistakes",hasOther:false},{key:"illegible",label:"Illegible or hard to read",hasOther:false},{key:"scan",label:"Low scan quality",hasOther:false}]},{key:"other",label:"It is something else",type:TYPE_ALL,secondaryReasons:[{key:"advertising",label:"Advertising or spam",hasOther:false},{key:"inappropriate",label:"Inappropriate content",hasOther:false},{key:"another_reason",label:"Another reason (please specify)",hasOther:true}]}]}function getReasonsByType(type){"use strict";var reasons=getReasons();if(type===TYPE_ALL){return reasons}else if(type===TYPE_FLAG){return reasons.filter(function(reason){return reason.type&&(reason.type===TYPE_ALL||reason.type===TYPE_FLAG)})}else if(type===TYPE_REVIEW){return reasons.filter(function(reason){return reason.type&&(reason.type===TYPE_ALL||reason.type===TYPE_REVIEW)})}return[]}return{getSecondaryReasonsMap:getSecondaryReasonsMap,getReasons:getReasons,getReasonsByType:getReasonsByType,TYPE_ALL:TYPE_ALL,TYPE_FLAG:TYPE_FLAG,TYPE_REVIEW:TYPE_REVIEW}})})();if(typeof contentServices==="undefined"){throw new Error("contentServices must be included to use ratingActions")}contentServices.service("ratingActions",function(dispatcher,apiService){var ratingActions={receiveDocuments:function(rows){dispatcher.dispatch(ratingActions.type.RECEIVE_DOCS,rows)},receiveQuestions:function(rows){dispatcher.dispatch(ratingActions.type.RECEIVE_QUESTIONS,rows)},receiveFlashcards:function(rows){dispatcher.dispatch(ratingActions.type.RECEIVE_FLASHCARDS,rows)},receiveContent:function(contentType,data){switch(contentType){case"document":ratingActions.receiveDocuments(data);break;case"question":ratingActions.receiveQuestions(data);break;case"flashcard":ratingActions.receiveFlashcards(data);break;default:break}},clearContent:function(){dispatcher.dispatch(ratingActions.type.CLEAR_CONTENT)},upvote:function(content,contentType,typeId){ratingApi.upvote(content,contentType,typeId)},downvote:function(content,contentType,typeId){ratingApi.downvote(content,contentType,typeId)},loadContent:function(contentType,limit,offset){ratingApi.loadContent(contentType,limit,offset)},rated:function(content,contentType){dispatcher.dispatch(ratingActions.type.RATED_CONTENT,{content:content,contentType:contentType})},saveReason:function(resourceType,resourceId,primaryReason,secondaryReason,text){return ratingApi.saveReason(resourceType,resourceId,primaryReason,secondaryReason,text)},type:{RECEIVE_DOCS:"ratingActions.type.RECEIVE_DOCS",RECEIVE_QUESTIONS:"ratingActions.type.RECEIVE_QUESTIONS",RECEIVE_FLASHCARDS:"ratingActions.type.RECEIVE_FLASHCARDS",RATED_CONTENT:"ratingActions.type.RATED_CONTENT",CLEAR_CONTENT:"ratingActions.type.CLEAR_CONTENT"}};var ratingApi=new function(){var UPVOTE_URL="/api/v1/{contentType}/{typeId}/like/";var DOWNVOTE_URL="/api/v1/{contentType}/{typeId}/dislike/";var LOAD_CONTENT="/api/v1/unrated/{contentType}/";var RATING_REASON_URL="/api/v1/_content/{resourceType}/{resourceId}/";return{upvote:function(content,contentType,typeId){apiService.post(UPVOTE_URL,{contentType:contentType,typeId:typeId}).success(function(response){content.rating=response.summary.avg_rating;ratingActions.rated(content,contentType)})},downvote:function(content,contentType,typeId){apiService.post(DOWNVOTE_URL,{contentType:contentType,typeId:typeId}).success(function(response){content.rating=response.summary.avg_rating;ratingActions.rated(content,contentType)})},loadContent:function(contentType,limit,offset){apiService.get(LOAD_CONTENT,{contentType:contentType,limit:limit,offset:offset}).success(function(response){if(response!==null&&response.length!==0){ratingActions.receiveContent(contentType,response)}})},saveReason:function(resourceType,resourceId,primaryReason,secondaryReason,text){return apiService.post(RATING_REASON_URL,{resourceType:resourceType,resourceId:resourceId,flag_document:{primaryReason:primaryReason,secondaryReason:secondaryReason,text:text,source:"Rating"}})}}};return ratingActions});if(typeof contentServices=="undefined"){throw new Error("contentServices is required to use rating store")}contentServices.service("ratingStore",function(dispatcher,ratingActions,documentStore,tutorsStore){var ratingStore=DataStore.create({dispatchIndex:dispatcher.register(function(payload){var action=payload.action;var data=payload.data;switch(action){case ratingActions.type.RECEIVE_DOCS:ratingStore.receiveDocs(data);break;case ratingActions.type.RECEIVE_QUESTIONS:ratingStore.receiveQuestions(data);break;case ratingActions.type.RECEIVE_FLASHCARDS:ratingStore.receiveFlashcards(data);break;case ratingActions.type.RATED_CONTENT:ratingStore.rated(data);break;case ratingActions.type.CLEAR_CONTENT:ratingStore.clearContent();break;default:break}}),receiveDocs:function(rawRows){var $me=this;rawRows.forEach(function(rawRow){$me.upsertRow("document","id",rawRow.db_filename,$me.sanitize({document:rawRow,id:rawRow.db_filename},ratingStore.schema.RatedDocument))});this.emit(ratingStore.events.UPDATE_DOCS)},receiveQuestions:function(rawRows){var $me=this;rawRows.forEach(function(rawRow){$me.upsertRow("question","id",rawRow.questionId,$me.sanitize({question:rawRow,id:rawRow.question_id},ratingStore.schema.RatedQuestion))});this.emit(ratingStore.events.UPDATE_QUESTIONS)},receiveFlashcards:function(rawRows){var $me=this;rawRows.forEach(function(rawRow){$me.upsertRow("flashcard","id",rawRow.fcsid,$me.sanitize(rawRow,ratingStore.schema.Flashcard))});this.emit(ratingStore.events.UPDATE_FLASHCARDS)},getUnratedDocuments:function(){return this.getRows("document").filter(function(a){return a.rating===null})},getUnratedQuestions:function(){return this.getRows("question").filter(function(a){return a.rating===null})},getUnratedFlashcards:function(){return this.getRows("flashcard").filter(function(a){return a.rating===null})},rated:function(data){if(data.contentType=="document"){var content=this.sanitize(data.content,ratingStore.schema.RatedDocument);this.upsertRow(data.contentType,"id",content.id,content);this.emit(ratingStore.events.UPDATE_DOCS)}if(data.contentType=="question"){var content=this.sanitize(data.content,ratingStore.schema.RatedQuestion);this.upsertRow(data.contentType,"id",content.id,content);this.emit(ratingStore.events.UPDATE_QUESTIONS)}if(data.contentType=="flashcard"){this.emit(ratingStore.events.UPDATE_FLASHCARDS)}},clearContent:function(){this.clear("document");this.clear("question");this.clear("flashcard");this.emit(ratingStore.events.UPDATE_DOCS);this.emit(ratingStore.events.UPDATE_QUESTIONS);this.emit(ratingStore.events.UPDATE_FLASHCARDS)},events:{UPDATE_DOCS:"ratingStore.events.UPDATE_DOCS",UPDATE_QUESTIONS:"ratingStore.events.UPDATE_QUESTIONS",UPDATE_FLASHCARDS:"ratingStore.events.UPDATE_FLASHCARDS"},schema:{RatedDocument:{document:{type:"object",schema:function(){return documentStore.SCHEMA.Document}},rating:{type:"int"},id:{type:"int"}},RatedQuestion:{question:{type:"object",schema:null},rating:{type:"int"},id:{type:"int"}},Flashcard:{}}});return ratingStore});if(typeof contentServices=="undefined"){throw new Error("contentServices is required to use ratingData")}contentServices.service("ratingData",function(apiService,$q,$window){var API_SUMMARY_URL="/api/v1/{contentType}/{typeId}/ratings/";var API_LIKE_URL="/api/v1/{contentType}/{typeId}/like/";var API_DISLIKE_URL="/api/v1/{contentType}/{typeId}/dislike/";var API_RESET_URL="/api/v1/{contentType}/{typeId}/ratings/";var ratingIncentiveRewardRemainingCount=0;var ratingIncentiveRewardTotalCount=0;var RatingStore=DataStore.create({summary:{},userRating:{},receiveRatingSummary:function(contentType,typeId,rawSummary){var summary=RatingStore.sanitize(rawSummary,RatingStore.schema.RatingSummary);RatingStore.setSummary(contentType,typeId,summary)},receiveUserRating:function(contentType,typeId,rawUserRating){var userRating=RatingStore.sanitize(rawUserRating,RatingStore.schema.UserRating);RatingStore.setUserRating(contentType,typeId,userRating);sendRatingWidgetMessage(contentType,typeId,userRating,RatingStore.getSummary(contentType,typeId))},getSummary:function(contentType,typeId){RatingStore.makeIfNotExists("summary",contentType,typeId);return RatingStore.sanitize(RatingStore.summary[contentType][typeId],RatingStore.schema.RatingSummary)},setSummary:function(contentType,typeId,summary){RatingStore.makeIfNotExists("summary",contentType,typeId);RatingStore.summary[contentType][typeId]=summary},setUserRating:function(contentType,typeId,userRating){RatingStore.makeIfNotExists("userRating",contentType,typeId);RatingStore.userRating[contentType][typeId]=userRating},getUserRating:function(contentType,typeId){RatingStore.makeIfNotExists("userRating",contentType,typeId);return RatingStore.sanitize(RatingStore.userRating[contentType][typeId],RatingStore.schema.UserRating)},makeIfNotExists:function(objType,contentType,typeId){if(typeof RatingStore[objType][contentType]==="undefined"){RatingStore[objType][contentType]={}}if(typeof RatingStore[objType][contentType][typeId]==="undefined"){RatingStore[objType][contentType][typeId]={}}},schema:{RatingSummary:{likes:DataStore.schema.int({initial:function(){return 0}}),dislikes:DataStore.schema.int({initial:function(){return 0}})},UserRating:{is_like:DataStore.schema.bool({initial:function(){return false}}),is_dislike:DataStore.schema.bool({initial:function(){return false}}),rating:DataStore.schema.int({initial:function(){return 0}}),content_type:DataStore.schema.string(),user_id:DataStore.schema.int()}}});var currentApiOperation=null;var currentApiType=null;var currentApiContentType=null;var currentApiTypeId=null;var removeApiOperation=function(){currentApiOperation=null;currentApiType=null;currentApiContentType=null;currentApiTypeId=null};var doApiCall=function(url,verb,contentType,typeId,sourceName){if(currentApiOperation!==null){return}currentApiContentType=contentType;currentApiTypeId=typeId;currentApiOperation=$q.defer();return apiService[verb](url,{contentType:contentType,typeId:typeId,sourceName:sourceName},{timeout:currentApiOperation}).success(processApiResults.bind(null,contentType,typeId)).then(removeApiOperation,removeApiOperation)};var processApiResults=function(contentType,typeId,response){$window.dispatchEvent(new Event("rateReviewRatingUpdate"));if(response.summary){RatingStore.receiveRatingSummary(contentType,typeId,response.summary)}if(response.user_rating){RatingStore.receiveUserRating(contentType,typeId,response.user_rating)}else{RatingStore.receiveUserRating(contentType,typeId,{})}};var getResourceTypeName=function(contentType,isPlural){if(contentType==="document"){return isPlural?"documents":"document"}else if(contentType==="question"){return isPlural?"Q&As":"Q&A"}else if(contentType==="flashcard"){return isPlural?"flashcards":"flashcard"}return""};var getRatingIncentiveMessage=function(contentType,typeId){var ratingIncentiveMessage="";var userRating=RatingStore.getUserRating(contentType,typeId);if(userRating.is_dislike||userRating.is_like){if(ratingIncentiveRewardRemainingCount-1>1){ratingIncentiveMessage="Thanks for rating! Rate "+(ratingIncentiveRewardRemainingCount-1)+" more "+getResourceTypeName(contentType,true)+" to earn a free unlock."}else if(ratingIncentiveRewardRemainingCount-1==1){ratingIncentiveMessage="Thanks for rating! Rate 1 more "+getResourceTypeName(contentType,false)+" to earn a free unlock."}else if(ratingIncentiveRewardRemainingCount-1==0){ratingIncentiveMessage="Thanks for rating! You should receive an unlock shortly."}}else{if(ratingIncentiveRewardRemainingCount>1){if(ratingIncentiveRewardRemainingCount==ratingIncentiveRewardTotalCount){ratingIncentiveMessage="Rate "+ratingIncentiveRewardRemainingCount+" "+getResourceTypeName(contentType,true)+" to earn a free unlock."}else{ratingIncentiveMessage="Rate "+ratingIncentiveRewardRemainingCount+" more "+getResourceTypeName(contentType,true)+" to earn a free unlock."}}else if(ratingIncentiveRewardRemainingCount==1){ratingIncentiveMessage="Rate 1 more "+getResourceTypeName(contentType,false)+" to earn a free unlock."}}return ratingIncentiveMessage};var sendRatingWidgetMessage=function(contentType,typeId,user_rating,summary){if(document.getElementById("flash-document")&&document.getElementById("flash-document").contentWindow){var iframeElm=document.getElementById("flash-document");var iframeWindow=iframeElm.contentWindow;var voteStr="reset";if(user_rating.is_like){voteStr="upvote"}else if(user_rating.is_dislike){voteStr="downvote"}var likes=0;var dislikes=0;if(summary){likes=summary.likes;dislikes=summary.dislikes}var ratingIncentiveMessage=getRatingIncentiveMessage(contentType,typeId);iframeWindow.postMessage(JSON.stringify({type:"ratingWidgetVote",vote:voteStr,likes:likes,dislikes:dislikes,ratingIncentiveMessage:ratingIncentiveMessage}),window.document.location.origin);iframeElm.setAttribute("data-rating-widget-vote",voteStr);iframeElm.setAttribute("data-rating-widget-likes",likes);iframeElm.setAttribute("data-rating-widget-dislikes",dislikes);iframeElm.setAttribute("data-rating-widget-incentive-message",ratingIncentiveMessage)}};return{loadRatings:function(contentType,typeId,ratingIncentiveResourceRemainingCount,ratingIncentiveResourceTotalCount){ratingIncentiveRewardRemainingCount=ratingIncentiveResourceRemainingCount;ratingIncentiveRewardTotalCount=ratingIncentiveResourceTotalCount;return apiService.get(API_SUMMARY_URL,{contentType:contentType,typeId:typeId}).success(processApiResults.bind(null,contentType,typeId))},getRatingIncentiveMessage:function(contentType,typeId){return getRatingIncentiveMessage(contentType,typeId)},getRatingSummary:function(contentType,typeId){return RatingStore.getSummary(contentType,typeId)},getUserRating:function(contentType,typeId){return RatingStore.getUserRating(contentType,typeId)},getResourceTypeName:function(contentType,isPlural){return getResourceTypeName(contentType,isPlural)},like:function(contentType,typeId,sourceName){if(!currentApiOperation){var userRating=RatingStore.getUserRating(contentType,typeId);var summary=RatingStore.getSummary(contentType,typeId);summary.likes++;if(userRating.is_dislike){summary.dislikes--}RatingStore.receiveRatingSummary(contentType,typeId,summary);RatingStore.receiveUserRating(contentType,typeId,{is_like:true,is_dislike:false,rating:100})}currentApiType="like";return doApiCall(API_LIKE_URL,"post",contentType,typeId,sourceName)},dislike:function(contentType,typeId,sourceName){if(!currentApiOperation){var userRating=RatingStore.getUserRating(contentType,typeId);var summary=RatingStore.getSummary(contentType,typeId);summary.dislikes++;if(userRating.is_like){summary.likes--}RatingStore.receiveRatingSummary(contentType,typeId,summary);RatingStore.receiveUserRating(contentType,typeId,{is_like:false,is_dislike:true,rating:-100})}currentApiType="dislike";return doApiCall(API_DISLIKE_URL,"post",contentType,typeId,sourceName)},reset:function(contentType,typeId,sourceName){if(!currentApiOperation){var userRating=RatingStore.getUserRating(contentType,typeId);var summary=RatingStore.getSummary(contentType,typeId);if(userRating.is_dislike){currentApiType="dislike";summary.dislikes--}else if(userRating.is_like){currentApiType="like";summary.likes--}RatingStore.receiveRatingSummary(contentType,typeId,summary);RatingStore.receiveUserRating(contentType,typeId,{})}return doApiCall(API_RESET_URL,"delete",contentType,typeId,sourceName)},isLoading:function(apiType,contentType,typeId){var currentApiCall=currentApiType===apiType&&currentApiOperation!==null;return typeof typeId==="undefined"?currentApiCall:contentType===currentApiContentType&&typeId===currentApiTypeId&&currentApiCall},rateReviewPopupLoaded:false}});
//# sourceMappingURL=https://www.coursehero.com/sym-assets/js/bundle-3a13201-844a56a.js.map